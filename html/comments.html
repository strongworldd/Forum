<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Commentaires du post</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1a1a1b;
      color: white;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: 60px auto;
      padding: 40px;
      background-color: #272729;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
      position: relative;
    }
    .topbar {
      background: none;
      box-shadow: none;
      padding: 0;
      margin-bottom: 0;
    }
    .topbar .container {
      background: none;
      box-shadow: none;
      padding: 0 0 20px 0;
      margin: 0 auto 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 0;
      max-width: 700px;
    }
    .topbar .center {
      flex: 1;
      text-align: center;
    }
    .topbar .right {
      display: flex;
      align-items: center;
      gap: 1em;
    }
    .btn.login {
      background-color: #FF4500;
      color: white;
      padding: 10px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      transition: background-color 0.3s;
    }
    .btn.login:hover {
      background-color: #cc3700;
    }
    #postDetails {
      background: #1a1a1b;
      border-radius: 10px;
      padding: 1.5rem 1rem 1rem 1rem;
      margin-bottom: 2rem;
      box-shadow: 0 1px 8px rgba(0,0,0,0.25);
      text-align: center;
      color: white;
      border: 1px solid #333;
    }
    #postDetails h2 {
      margin-top: 0;
      font-size: 1.5rem;
      color: #FF4500;
    }
    #postDetails img {
      border-radius: 10px;
      margin: 1rem 0;
      max-width: 100%;
      box-shadow: 0 1px 8px rgba(0,0,0,0.3);
    }
    #commentsSection h3 {
      margin-bottom: 1.2rem;
      color: #FF4500;
      font-size: 1.2rem;
      letter-spacing: 0.5px;
    }
    #commentsList {
      display: flex;
      flex-direction: column;
      gap: 1.1rem;
      margin-bottom: 1.5rem;
    }
    #commentsList > div {
      background: #232324;
      border-radius: 10px;
      padding: 0.8rem 1.1rem;
      box-shadow: 0 1px 4px rgba(0,0,0,0.15);
      display: flex;
      align-items: flex-start;
      gap: 0.7rem;
      font-size: 1rem;
      word-break: break-word;
      border: 1px solid #333;
      color: #fff;
    }
    #commentsList > div::before {
      content: 'ðŸ‘¤';
      font-size: 1.2em;
      margin-right: 0.5em;
      opacity: 0.7;
    }
    #commentsList b {
      color: #6ec6ff;
      margin-right: 0.3em;
    }
    #commentForm {
      display: flex;
      gap: 0.7em;
      align-items: center;
      background: #232324;
      border-radius: 10px;
      padding: 0.7em 1em;
      box-shadow: 0 1px 4px rgba(0,0,0,0.15);
      border: 1px solid #333;
    }
    #commentForm input[type="text"] {
      flex: 1;
      border: none;
      border-radius: 8px;
      padding: 0.7em 1em;
      font-size: 1em;
      background: #1a1a1b;
      color: #fff;
      border: 1px solid #555;
      box-shadow: 0 1px 2px rgba(0,0,0,0.08);
      outline: none;
      transition: border-color 0.2s;
    }
    #commentForm input[type="text"]:focus {
      border-color: #FF4500;
    }
    #commentForm button {
      background-color: #FF4500;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.7em 1.3em;
      font-size: 1em;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 1px 4px rgba(0,0,0,0.15);
      transition: background 0.2s, background-color 0.2s;
    }
    #commentForm button:hover {
      background-color: #cc3700;
    }
    @media (max-width: 800px) {
      .container {
        padding: 1rem 0.5rem;
      }
      .topbar .container {
        padding: 0 0.5rem 20px 0.5rem;
      }
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="container">
      <div class="center">
        <h2>Commentaires</h2>
      </div>
      <div class="right">
        <button class="btn login" onclick="window.location.href='/html/home copy.html'">Accueil</button>
      </div>
    </div>
  </header>
  <main class="container">
    <section id="postDetails"></section>
    <section id="commentsSection">
      <h3>Commentaires</h3>
      <div id="commentsList"></div>
      <form id="commentForm" style="display:none; margin-top:1em;">
        <input type="text" name="comment" placeholder="Ajouter un commentaire..." required style="width:80%;">
        <button type="submit">Envoyer</button>
      </form>
    </section>
  </main>
  <script>
    // RÃ©cupÃ¨re l'id du post depuis l'URL
    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get('post_id');
    if (!postId) {
      document.getElementById('postDetails').innerText = 'Aucun post sÃ©lectionnÃ©.';
      document.getElementById('commentsSection').style.display = 'none';
    } else {
      // Affiche les infos du post
      fetch(`/api/posts`)
        .then(res => res.json())
        .then(posts => {
          const post = posts.find(p => p.id == postId);
          if (!post) {
            document.getElementById('postDetails').innerText = 'Post introuvable.';
            document.getElementById('commentsSection').style.display = 'none';
            return;
          }
          document.getElementById('postDetails').innerHTML = `
            <h2>${post.title}</h2>
            <div><img src="/img/${post.content}" alt="Image du post" style="max-width:300px;"/></div>
            <div>Auteur : <b>${post.author}</b></div>
          `;
        });
      // Affiche les commentaires
      function loadComments() {
        fetch(`/api/comments?post_id=${postId}`)
          .then(res => res.json())
          .then(comments => {
            const list = document.getElementById('commentsList');
            list.innerHTML = '';
            comments.forEach(c => {
              const cDiv = document.createElement('div');
              cDiv.innerHTML = `<b>${c.author}</b> : ${c.content}`;
              list.appendChild(cDiv);
            });
          });
      }
      loadComments();
      // Affiche le formulaire si connectÃ©
      fetch('/api/me')
        .then(res => {
          if (!res.ok) throw new Error();
          return res.json();
        })
        .then(user => {
          document.getElementById('commentForm').style.display = 'flex';
        })
        .catch(() => {
          document.getElementById('commentForm').style.display = 'none';
        });
      // Soumission du commentaire
      document.getElementById('commentForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const input = this.querySelector('input[name="comment"]');
        fetch('/api/comment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ post_id: Number(postId), content: input.value })
        }).then(res => {
          if (res.ok) {
            loadComments();
            input.value = '';
          } else {
            alert('Erreur lors de l\'ajout du commentaire');
          }
        });
      });
    }
  </script>
</body>
</html>
